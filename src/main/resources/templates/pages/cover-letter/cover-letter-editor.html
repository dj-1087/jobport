<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/base}">
<head>
    <title layout:fragment="title">자기소개서 작성</title>

    <th:block layout:fragment="head-extra">
        <meta name="_csrf" th:content="${_csrf.token}"/>
        <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
        <link rel="stylesheet" th:href="@{/css/cover-letter-editor.css}">
    </th:block>
</head>
<body>
<section layout:fragment="content"
         th:with="coverLetterCount=${coverLetters == null ? 0 : coverLetters.size()}">
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <div>
            <h1 class="h3 mb-1 text-gray-800">자기소개서 작성</h1>
            <div class="text-gray-600 small">지원 기관별 자기소개서 문항을 정리하고 초안을 작성할 수 있습니다.</div>
        </div>
        <div class="text-right">
            <button type="button"
                    class="btn btn-sm btn-outline-secondary shadow-sm mr-2"
                    id="cover-letter-preview-trigger">
                <i class="fas fa-eye fa-sm text-secondary"></i>
                전체 미리보기
            </button>
            <button type="button"
                    class="btn btn-sm btn-primary shadow-sm"
                    id="cover-letter-add-trigger">
                <i class="fas fa-plus fa-sm text-white-50"></i>
                새 문항 추가
            </button>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-4 mb-4">
            <div class="card shadow mb-4">
                <div class="card-header py-3 d-flex justify-content-between align-items-center">
                    <h6 class="m-0 font-weight-bold text-primary">작성 현황</h6>
                    <span class="badge badge-pill badge-info"
                          data-cover-letter-total
                          th:text="'총 ' + ${coverLetterCount} + '건'">총 0건</span>
                </div>
                <div class="card-body">
                    <div class="cover-letter-progress">
                        <div class="cover-letter-progress__item">
                            <div class="small text-gray-600">작성 완료</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800"
                                 data-cover-letter-complete
                                 th:text="${coverLetterCount}">0</div>
                        </div>
                        <div class="cover-letter-progress__item">
                            <div class="small text-gray-600">임시 저장</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800"
                                 data-cover-letter-draft
                                 th:text="${coverLetterCount == 0 ? 0 : coverLetterCount - 1}">0</div>
                        </div>
                    </div>
                    <div class="progress mt-3 mb-2" style="height: 6px;">
                        <div class="progress-bar bg-primary"
                             role="progressbar"
                             id="cover-letter-progress-bar"
                             th:style="'width:' + (${coverLetterCount} == 0 ? 10 : 90) + '%'"
                             aria-valuenow="70" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <div class="small text-gray-500">
                        작성한 문항은 저장 후 언제든지 수정할 수 있습니다.
                    </div>
                </div>
            </div>

            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">작성 가이드</h6>
                </div>
                <div class="card-body small text-gray-700">
                    <ul class="pl-3 mb-0">
                        <li class="mb-2">문항 의도를 먼저 정리한 뒤, 도입-전개-결론 구조로 작성하세요.</li>
                        <li class="mb-2">핵심 키워드를 3개 내외로 선정하면 스토리 라인이 선명해집니다.</li>
                        <li class="mb-2">각 문항별 글자 수 제한을 초과하지 않도록 실시간으로 확인하세요.</li>
                        <li class="mb-0">작성 중간에도 임시 저장을 눌러 초안을 안전하게 보관하세요.</li>
                    </ul>
                </div>
            </div>

            <div class="card shadow mb-4">
                <div class="card-header py-3 d-flex justify-content-between align-items-center">
                    <h6 class="m-0 font-weight-bold text-primary">최근 편집</h6>
                    <span class="badge badge-light text-gray-600 small"
                          th:text="'최근 ' + ${coverLetterCount} + '건'">최근 0건</span>
                </div>
                <div class="card-body">
                    <div th:if="${coverLetterCount == 0}" class="text-gray-500 small">
                        아직 등록된 자기소개서 문항이 없습니다.
                    </div>
                    <div th:each="coverLetter, iter : ${coverLetters}"
                         th:if="${iter.index < 3}"
                         class="mb-3 cover-letter-recent">
                        <div class="font-weight-bold text-gray-800 small"
                             th:text="${coverLetter.itemTitle} ?: '문항 제목 미입력'">문항 제목</div>
                        <div class="text-gray-500 small">
                            <i class="fas fa-clock mr-1"></i>
                            <span th:text="${coverLetter.updatedAt != null ?
                                #temporals.format(coverLetter.updatedAt, 'yyyy.MM.dd HH:mm') :
                                '임시 저장'}">2024.04.01 12:00</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-8 mb-4">
            <div class="cover-letter-editor-wrapper">
                <div id="cover-letter-empty-state"
                     class="card shadow-sm mb-4 border-left-primary"
                     th:classappend="${coverLetterCount > 0} ? ' d-none'">
                    <div class="card-body text-center py-5">
                        <div class="h5 text-gray-700 mb-2">첫 자기소개서 문항을 추가해보세요</div>
                        <p class="text-gray-500 small mb-4">
                            문항 제목과 글자 수 제한을 지정하면 초안 템플릿이 생성됩니다.
                        </p>
                        <button type="button" class="btn btn-primary btn-sm"
                                id="cover-letter-empty-add">
                            <i class="fas fa-plus mr-1"></i> 새 문항 추가
                        </button>
                    </div>
                </div>

                <div id="cover-letter-editor-list"
                     th:data-count="${coverLetterCount}">
                    <th:block th:each="coverLetter, iter : ${coverLetters}">
                        <div th:replace="~{pages/cover-letter/cover-letter-editor :: cover-letter-card(iter=${iter.index}, coverLetter=${coverLetter})}"></div>
                    </th:block>
                </div>
            </div>
        </div>
    </div>

    <template id="cover-letter-template">
        <div class="card shadow-sm cover-letter-card mb-4 border-left-primary" data-index="" data-id="">
        <div class="card-header d-flex justify-content-between align-items-center flex-wrap">
            <div class="mr-3">
                <div class="text-gray-500 small">문항 <span class="cover-letter-order">1</span></div>
                <input type="text"
                       class="form-control form-control-sm font-weight-bold cover-letter-title-input"
                       maxlength="200"
                       placeholder="문항 제목을 입력하세요">
            </div>
            <div class="text-right">
                <div class="small text-gray-500 mb-1">
                    <i class="fas fa-sync-alt mr-1 text-primary"></i>
                    <span class="cover-letter-updated-at">방금 전</span>
                </div>
                <div>
                    <button type="button"
                            class="btn btn-outline-light btn-sm text-gray-600 cover-letter-duplicate mr-2">
                        <i class="fas fa-copy"></i>
                    </button>
                    <button type="button"
                            class="btn btn-outline-light btn-sm text-gray-600 cover-letter-remove">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>
            </div>
        </div>
        <div class="card-body">
            <div class="form-group">
                <label class="small text-gray-600">문항 설명</label>
                <input type="text"
                       class="form-control form-control-sm cover-letter-desc-input"
                       maxlength="255"
                       placeholder="예: MZ 세대 공무원으로서 이루고 싶은 목표를 구체적으로 작성하세요.">
            </div>
            <div class="form-group mb-3">
                <div class="d-flex justify-content-between align-items-center">
                    <label class="mb-0 small text-gray-600">본문</label>
                    <div class="small text-gray-500">
                        <span class="cover-letter-text-count">0</span> /
                        <span class="cover-letter-text-limit">1000</span>자
                    </div>
                </div>
                <textarea class="form-control cover-letter-textarea"
                          rows="8"
                          maxlength="8000"
                          data-limit="1000"
                          placeholder="경험 기반으로 자기소개서를 작성해보세요."></textarea>
            </div>
            <div class="form-row">
                <div class="form-group col-md-7">
                    <label class="small text-gray-600">핵심 키워드</label>
                    <input type="text"
                           class="form-control form-control-sm cover-letter-keyword-input"
                           placeholder="예: 공공성, 협업, 데이터 분석">
                </div>
                <div class="form-group col-md-5">
                    <label class="small text-gray-600">글자 수 제한</label>
                    <input type="number"
                           class="form-control form-control-sm cover-letter-limit-input"
                           placeholder="1000"
                           min="300"
                           max="1500"
                           value="1000">
                </div>
            </div>
            <div class="text-right">
                <button type="button" class="btn btn-outline-secondary btn-sm mr-2 cover-letter-preview-btn">미리보기</button>
                <button type="button" class="btn btn-primary btn-sm cover-letter-save">임시 저장</button>
            </div>
        </div>
    </div>
    </template>
</section>

<th:block layout:fragment="script-extra">
    <script th:src="@{/js/cover-letter-editor.js}"></script>
</th:block>

<!-- Template fragment for server data -->
<th:block th:fragment="cover-letter-card (iter, coverLetter)">
    <div class="card shadow-sm cover-letter-card mb-4 border-left-primary"
         th:attr="data-index=${iter},data-id=${coverLetter.id}">
        <div class="card-header d-flex justify-content-between align-items-center flex-wrap">
            <div class="mr-3">
                <div class="text-gray-500 small">문항 <span class="cover-letter-order"
                                                       th:text="${iter + 1}">1</span></div>
                <input type="text"
                       class="form-control form-control-sm font-weight-bold cover-letter-title-input"
                       maxlength="200"
                       placeholder="문항 제목을 입력하세요"
                       th:value="${coverLetter.itemTitle}">
            </div>
            <div class="text-right">
                <div class="small text-gray-500 mb-1">
                    <i class="fas fa-sync-alt mr-1 text-primary"></i>
                    <span class="cover-letter-updated-at"
                          th:text="${coverLetter.updatedAt != null ?
                        #temporals.format(coverLetter.updatedAt, 'yyyy.MM.dd HH:mm') :
                        '임시 저장'}">임시 저장</span>
                </div>
                <div>
                    <button type="button"
                            class="btn btn-outline-light btn-sm text-gray-600 cover-letter-duplicate mr-2">
                        <i class="fas fa-copy"></i>
                    </button>
                    <button type="button"
                            class="btn btn-outline-light btn-sm text-gray-600 cover-letter-remove">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>
            </div>
        </div>
        <div class="card-body">
            <div class="form-group">
                <label class="small text-gray-600">문항 설명</label>
                <input type="text"
                       class="form-control form-control-sm cover-letter-desc-input"
                       maxlength="255"
                       placeholder="문항의 요구사항을 간단히 정리해두면 좋습니다.">
            </div>
            <div class="form-group mb-3">
                <div class="d-flex justify-content-between align-items-center">
                    <label class="mb-0 small text-gray-600">본문</label>
                    <div class="small text-gray-500">
                        <span class="cover-letter-text-count"
                              th:text="${coverLetter.content != null ? #strings.length(coverLetter.content) : 0}">0</span>
                        /
                        <span class="cover-letter-text-limit">1000</span>자
                    </div>
                </div>
                <textarea class="form-control cover-letter-textarea"
                          rows="8"
                          maxlength="8000"
                          data-limit="1000"
                          placeholder="경험 기반으로 자기소개서를 작성해보세요."
                          th:text="${coverLetter.content}">내용</textarea>
            </div>
            <div class="form-row">
                <div class="form-group col-md-7">
                    <label class="small text-gray-600">핵심 키워드</label>
                    <input type="text"
                           class="form-control form-control-sm cover-letter-keyword-input"
                           placeholder="예: 공공성, 협업, 데이터 분석">
                </div>
                <div class="form-group col-md-5">
                    <label class="small text-gray-600">글자 수 제한</label>
                    <input type="number"
                           class="form-control form-control-sm cover-letter-limit-input"
                           placeholder="1000"
                           min="300"
                           max="1500"
                           value="1000">
                </div>
            </div>
            <div class="text-right">
                <button type="button" class="btn btn-outline-secondary btn-sm mr-2 cover-letter-preview-btn">미리보기</button>
                <button type="button" class="btn btn-primary btn-sm cover-letter-save">임시 저장</button>
            </div>
        </div>
    </div>
</th:block>
</body>
</html>
