<!-- templates/pages/edit.html -->
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/base}">
<head>
    <title layout:fragment="title">채용 공고 목록</title>

    <!-- index가 포함한 fragment들의 head-extra를 모아서 전달 -->
    <th:block layout:fragment="head-extra">
    </th:block>
</head>

<body>
<section layout:fragment="content">
    <!-- Page Heading -->
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-gray-800">채용 공고 통계</h1>
        <a href="#" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm">
            <i class="fas fa-download fa-sm text-white-50"></i> Export Report
        </a>
    </div>

    <!-- Content Row: 상단 2개 그래프 -->
    <div class="row">

        <!-- 근무지(지역)별 공고 수 -->
        <div class="col-xl-6 col-lg-6">
            <div class="card shadow mb-4">
                <!-- Card Header -->
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">근무지(지역)별 공고 수</h6>
                </div>
                <!-- Card Body -->
                <div class="card-body">
                    <div class="chart-bar" style="height: 350px;">
                        <canvas id="workLocationChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- 학력 요건별 공고 수 -->
        <div class="col-xl-6 col-lg-6">
            <div class="card shadow mb-4">
                <!-- Card Header -->
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-success">학력 요건별 공고 수</h6>
                </div>
                <!-- Card Body -->
                <div class="card-body">
                    <div class="chart-bar" style="height: 350px;">
                        <canvas id="educationChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Content Row: NCS 그래프 -->
    <div class="row">
        <div class="col-xl-12 col-lg-12">
            <div class="card shadow mb-4">
                <!-- Card Header -->
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-info">NCS(표준직무)별 공고 수</h6>
                    <span class="small text-muted">NCS 분류 25개 기준</span>
                </div>
                <!-- Card Body -->
                <div class="card-body">
                    <div class="chart-bar" style="height: 500px;">
                        <canvas id="ncsChart"></canvas>
                    </div>
                    <small class="text-muted">* 분류명이 길 경우, 마우스를 올리면 전체 명칭을 Tooltip으로 확인할 수 있습니다.</small>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- fragment별 script 모음 -->
<th:block layout:fragment="script-extra">
    <!-- Page level plugins -->
    <script th:src="@{/vendor/chart.js/Chart.min.js}"></script>

    <!-- Page level custom scripts -->
    <script th:src="@{/js/demo/chart-area-demo.js}"></script>
    <script th:src="@{/js/demo/chart-pie-demo.js}"></script>
    <!-- Page level custom scripts (inline) -->
    <script th:inline="javascript">
        /*<![CDATA[*/

        // Thymeleaf에서 넘어온 데이터 (없으면 빈 배열)
        var workLocationLabels = /*[[${workLocationLabels}]]*/ [];
        console.log(workLocationLabels);
        var workLocationCounts = /*[[${workLocationCounts}]]*/ [];

        var educationLabels = /*[[${educationLabels}]]*/ [];
        var educationCounts = /*[[${educationCounts}]]*/ [];

        var ncsLabels = /*[[${ncsLabels}]]*/ [];
        var ncsCounts = /*[[${ncsCounts}]]*/ [];

        // SB Admin 2 기본 차트 폰트 설정 (Chart.js 2.x 기준)
        Chart.defaults.global.defaultFontFamily = 'Nunito', '-apple-system,system-ui,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif';
        Chart.defaults.global.defaultFontColor = '#858796';

        // 유틸: 랜덤 색상 생성 (카테고리 개수가 유동적인 경우 사용)
        function generateColors(length, baseColor) {
            var colors = [];
            for (var i = 0; i < length; i++) {
                // 약간씩 다른 알파값으로 차이만 줌
                colors.push(baseColor || 'rgba(78, 115, 223, 0.7)');
            }
            return colors;
        }

        // 근무지(지역)별 공고 수 막대 그래프
        var ctxWorkLocation = document.getElementById("workLocationChart");
        if (ctxWorkLocation) {
            new Chart(ctxWorkLocation, {
                type: 'bar',
                data: {
                    labels: workLocationLabels,
                    datasets: [{
                        label: "공고 수",
                        data: workLocationCounts,
                        backgroundColor: generateColors(workLocationLabels.length, 'rgba(78, 115, 223, 0.7)'),
                        borderColor: 'rgba(78, 115, 223, 1)',
                        borderWidth: 1,
                        maxBarThickness: 40
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    layout: {
                        padding: {
                            left: 10,
                            right: 25,
                            top: 25,
                            bottom: 10
                        }
                    },
                    scales: {
                        xAxes: [{
                            gridLines: {
                                display: false,
                                drawBorder: false
                            },
                            ticks: {
                                maxTicksLimit: 10
                            }
                        }],
                        yAxes: [{
                            ticks: {
                                beginAtZero: true,
                                precision: 0
                            },
                            gridLines: {
                                color: "rgb(234, 236, 244)",
                                zeroLineColor: "rgb(234, 236, 244)",
                                drawBorder: false,
                                borderDash: [2],
                                zeroLineBorderDash: [2]
                            }
                        }]
                    },
                    legend: {
                        display: false
                    },
                    tooltips: {
                        titleMarginBottom: 10,
                        titleFontColor: '#6e707e',
                        titleFontSize: 14,
                        backgroundColor: "rgb(255,255,255)",
                        bodyFontColor: "#858796",
                        borderColor: '#dddfeb',
                        borderWidth: 1,
                        xPadding: 15,
                        yPadding: 15,
                        displayColors: false,
                        caretPadding: 10,
                        callbacks: {
                            label: function(tooltipItem, data) {
                                return ' 공고 수 : ' + tooltipItem.yLabel;
                            }
                        }
                    }
                }
            });
        }

        // 학력 요건별 공고 수 막대 그래프
        var ctxEducation = document.getElementById("educationChart");
        if (ctxEducation) {
            new Chart(ctxEducation, {
                type: 'bar',
                data: {
                    labels: educationLabels,
                    datasets: [{
                        label: "공고 수",
                        data: educationCounts,
                        backgroundColor: generateColors(educationLabels.length, 'rgba(28, 200, 138, 0.7)'),
                        borderColor: 'rgba(28, 200, 138, 1)',
                        borderWidth: 1,
                        maxBarThickness: 40
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    layout: {
                        padding: {
                            left: 10,
                            right: 25,
                            top: 25,
                            bottom: 10
                        }
                    },
                    scales: {
                        xAxes: [{
                            gridLines: {
                                display: false,
                                drawBorder: false
                            },
                            ticks: {
                                maxTicksLimit: 10
                            }
                        }],
                        yAxes: [{
                            ticks: {
                                beginAtZero: true,
                                precision: 0
                            },
                            gridLines: {
                                color: "rgb(234, 236, 244)",
                                zeroLineColor: "rgb(234, 236, 244)",
                                drawBorder: false,
                                borderDash: [2],
                                zeroLineBorderDash: [2]
                            }
                        }]
                    },
                    legend: {
                        display: false
                    },
                    tooltips: {
                        titleMarginBottom: 10,
                        titleFontColor: '#6e707e',
                        titleFontSize: 14,
                        backgroundColor: "rgb(255,255,255)",
                        bodyFontColor: "#858796",
                        borderColor: '#dddfeb',
                        borderWidth: 1,
                        xPadding: 15,
                        yPadding: 15,
                        displayColors: false,
                        caretPadding: 10,
                        callbacks: {
                            label: function(tooltipItem, data) {
                                return ' 공고 수 : ' + tooltipItem.yLabel;
                            }
                        }
                    }
                }
            });
        }

        // NCS(표준직무)별 공고 수 - 가로 막대 그래프 (카테고리 25개)
        var ctxNcs = document.getElementById("ncsChart");
        if (ctxNcs) {
            new Chart(ctxNcs, {
                type: 'horizontalBar',
                data: {
                    labels: ncsLabels,
                    datasets: [{
                        label: "공고 수",
                        data: ncsCounts,
                        backgroundColor: generateColors(ncsLabels.length, 'rgba(54, 185, 204, 0.7)'),
                        borderColor: 'rgba(54, 185, 204, 1)',
                        borderWidth: 1,
                        maxBarThickness: 20
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    layout: {
                        padding: {
                            left: 10,
                            right: 30,
                            top: 20,
                            bottom: 10
                        }
                    },
                    scales: {
                        xAxes: [{
                            ticks: {
                                beginAtZero: true,
                                precision: 0
                            },
                            gridLines: {
                                color: "rgb(234, 236, 244)",
                                zeroLineColor: "rgb(234, 236, 244)",
                                drawBorder: false,
                                borderDash: [2],
                                zeroLineBorderDash: [2]
                            }
                        }],
                        yAxes: [{
                            gridLines: {
                                display: false,
                                drawBorder: false
                            },
                            ticks: {
                                // NCS 25개도 스크롤 없이 보이도록 글자 조금 줄이기
                                fontSize: 10,
                                callback: function(value, index, values) {
                                    // 너무 길면 앞부분만 보여주고 Tooltip에서 전체 확인
                                    if (value.length > 20) {
                                        return value.substring(0, 20) + '...';
                                    }
                                    return value;
                                }
                            }
                        }]
                    },
                    legend: {
                        display: false
                    },
                    tooltips: {
                        titleMarginBottom: 10,
                        titleFontColor: '#6e707e',
                        titleFontSize: 14,
                        backgroundColor: "rgb(255,255,255)",
                        bodyFontColor: "#858796",
                        borderColor: '#dddfeb',
                        borderWidth: 1,
                        xPadding: 15,
                        yPadding: 15,
                        displayColors: false,
                        caretPadding: 10,
                        callbacks: {
                            title: function(tooltipItems, data) {
                                // Tooltip에는 전체 NCS 분류명 표시
                                var idx = tooltipItems[0].index;
                                return data.labels[idx];
                            },
                            label: function(tooltipItem, data) {
                                return ' 공고 수 : ' + tooltipItem.xLabel;
                            }
                        }
                    }
                }
            });
        }

        /*]]>*/
    </script>

</th:block>
</body>
</html>